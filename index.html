<style>
  /*.line-canvas {
    height: 100px;
    width: 100px;
    position: absolute;   // Declared as static
  }*/
</style>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

  </head>
  <body>

    <canvas id="line0.0" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line0.1" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line0.2" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line0.3" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line0.4" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line0.5" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>

    <canvas id="line1.0" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line1.1" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line1.2" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line1.3" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line1.4" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line1.5" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>

    <canvas id="line2.0" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line2.1" height="100px" width="100px" style="border:1px solid #d3d3d3;"></canvas>
    <canvas id="line2.2" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line2.3" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line2.4" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line2.5" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>

    <canvas id="line3.0" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line3.1" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line3.2" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line3.3" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line3.4" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line3.5" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>

    <canvas id="line4.0" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line4.1" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line4.2" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line4.3" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line4.4" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line4.5" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>

    <canvas id="line5.0" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line5.1" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line5.2" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line5.3" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line5.4" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>
    <canvas id="line5.5" height="100px" width="100px" style="border:0px solid #d3d3d3;"></canvas>

  </body>

</html>


<script>
  // CANVAS, LINE, AND MOUSE FUNCTIONS

  function lineStruct(canvasID, xpos, ypos) {
    this.canvasID = canvasID;
    this.xpos = xpos;
    this.ypos = ypos;
  }

  let canvasWidth = 100;
  let canvasHeight = 100;
  let numRows = 6;
  let numCols = 6;
  let lineWidth = 8;

  let linesArr = [];

  // returns the index of the element at row, col
  function getIndex(r, c) {
    return r * numCols + c;
  }

  // populates the linesArr
  for (let r=0; r<numRows; r++) {
    for (let c=0; c<numCols; c++) {
      newID = "line" + r + "." + c;
      newLineStruct = new lineStruct(newID, 0, 0);
      linesArr.push(newLineStruct);
    }
  }

  // sets the position of every canvas on the window
  function setCanvasPositions() {
    for (let r=0; r<numRows; r++) {
      for (let c=0; c<numCols; c++) {
        let index = getIndex(r, c);

        let can = document.getElementById(linesArr[index].canvasID);
        let xpos1 = c*canvasWidth;
        let xString = xpos1.toString();
        let ypos1 = r*canvasHeight;
        let yString = ypos1.toString();
        can.style.top = yString+"px";
        can.style.left = xString+"px";
        can.style.position = "absolute";

        linesArr[index].xpos = xpos1;
        linesArr[index].ypos = ypos1;
      }
    }
  }

  // initializes/resets the canvas
  function initCanvas(c, ctx) {
    ctx.clearRect(0, 0, 200, 100);
    ctx.beginPath();
  }

  let mouseX;
  let mouseY;

  // retrieves the mouse coordinates
  document.addEventListener("mousemove", (event) => {
    mouseX = event.clientX;
    mouseY = event.clientY;
  });

  // LINE FUNCTIONS

  function drawLine(lStruct, color, lineWid, x1, y1, x2, y2) {
    let c = document.getElementById(lStruct.canvasID);
    let ctx = c.getContext("2d");
    initCanvas(c, ctx);
    ctx.strokeStyle = color;
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.lineWidth = lineWid;
    ctx.stroke();
  }

  function getRainbowLineColor0(mouseX, mouseY) {
    let changeFactor = 0.5;
    let hue = (changeFactor * mouseX) + (changeFactor * mouseY) % 360;
    let col = "hsl(" + hue + ", 50%, 50%)";

    return col;
  }

  function getRainbowLineColor1(lStruct, mouseX, mouseY) {
    // retrieve the id of given lStruct
    let id = lStruct.canvasID;

    // parse id to retrieve index value
    let idArray = id.split("line")[1].split(".");
    let r = parseInt(idArray[0], 10);
    let c = parseInt(idArray[1], 10);
    let index = getIndex(r, c);

    // "spread out" hue values amongst the canvas cells
    let numCells = numRows * numCols;
    let hue = index * (360 / numCells);

    // have hue change as mouse moves
    let changeFactor = 0.5;
    hue = (hue + (changeFactor * mouseX) + (changeFactor * mouseY)) % 360;

    return "hsl(" + hue + ", 50%, 50%)";
  }

  function pointToCursor0(lStruct) {
    let topLeftX = lStruct.xpos;
    let topLeftY = lStruct.ypos;
    let bottomRightX = topLeftX + canvasWidth;
    let bottomRightY = topLeftY + canvasHeight;

    let x1 = mouseX - topLeftX;
    let y1 = mouseY - topLeftY;
    let x2 = bottomRightX - mouseX;
    let y2 = bottomRightY - mouseY;

    // let color = getRainbowLineColor0(mouseX, mouseY);
    let color = getRainbowLineColor1(lStruct, mouseX, mouseY);
    console.log(color);
    drawLine(lStruct, color, lineWidth, x1, y1, x2, y2);
  }

  function pointToCursor1(lStruct) {
    let topLeftX = lStruct.xpos;
    let topLeftY = lStruct.ypos;

    let x1 = mouseX - topLeftX;
    let y1 = mouseY - topLeftY;
    let x2 = canvasWidth - x1;
    let y2 = canvasHeight - x2;

    // let color = getRainbowLineColor0(mouseX, mouseY);
    let color = getRainbowLineColor1(lStruct, mouseX, mouseY);
    drawLine(lStruct, color, lineWidth, x1, y1, x2, y2);
  }

  // perpendicular to pointToCursor0
  function circleLines(lStruct) {
    let topLeftX = lStruct.xpos;
    let topLeftY = lStruct.ypos;
    let bottomRightX = topLeftX + canvasWidth;
    let bottomRightY = topLeftY + canvasHeight;

    let x1 = mouseX - topLeftX;
    let y1 = mouseY - topLeftY;
    let x2 = bottomRightX - mouseX;
    let y2 = bottomRightY - mouseY;

    let centerX = (canvasWidth/2);
    let centerY = (canvasHeight/2);
    let x3 = x1 - centerX;
    let y3 = y1 - centerY;
    let x4 = x2 - centerX;
    let y4 = y2 - centerY;
    let tempx3 = x3;
    x3 = y3 * -1;
    y3 = tempx3;
    let tempx4 = x4;
    x4 = y4 * -1;
    y4 = tempx4;
    x3 = x3 + centerX;
    y3 = y3 + centerY;
    x4 = x4 + centerX;
    y4 = y4 + centerY;
    let color = getRainbowLineColor1(lStruct, mouseX, mouseY);
    drawLine(lStruct, color, lineWidth, x3, y3, x4, y4);
  }

  // returns true if mouse is inside of the struct inputted
  function mouseInCanvas(lStruct) {
    return (mouseX >= lStruct.xpos) && (mouseX <= lStruct.xpos+canvasWidth)
        && (mouseY >= lStruct.ypos) && (mouseY <= lStruct.ypos+canvasHeight);
  }

  // returns true if mouse is in a square in the row of the inputted canvas
  function mouseInRow(lStruct) {
    return (mouseY >= lStruct.ypos) && (mouseY <= lStruct.ypos+canvasHeight);
  }

  // returns true if mouse is in a square in the column of the inputted canvas
  function mouseInCol(lStruct) {
    return (mouseX >= lStruct.xpos) && (mouseX <= lStruct.xpos+canvasWidth);
  }

  function newPattern(lStruct) {
    let centerX = lStruct.xpos + (canvasWidth/2);
    let centerY = lStruct.ypos + (canvasHeight/2);

    let x1 = 0;
    let y1 = 0;
    let x2 = 0;
    let y2 = 0;

    if (mouseInCanvas(lStruct)) {
      x1 = lStruct.xpos - 20;
      x2 = x1;
      y1 = lStruct.ypos - 20;
      y2 = y1;
    } else if (mouseInRow(lStruct)) {
      x1 = lStruct.xpos;
      x2 = x1 + canvasWidth;
      y1 = lStruct.ypos + (canvasHeight/2);
      y2 = y1;
      console.log(lStruct.canvasID+": "+x1+", "+y1+"; "+x2+", "+y2);
    } else if (mouseInCol(lStruct)) {
      x1 = lStruct.xpos + (canvasWidth/2);
      x2 = x1;
      y1 = lStruct.ypos;
      y2 = y1 + canvasHeight;
      console.log(lStruct.canvasID+": "+x1+", "+y1+"; "+x2+", "+y2);
    } /*else {
      if (mouseY > centerY) {
        y1 = canvasHeight * numRows;
      } else {
        y1 = 0;
      }
      x1 = mouseX;
      x2 = lStruct.xpos + canvasWidth - mouseX;
      y2 = lStruct.ypos + canvasHeight - mouseY;
    }*/

    // let color = getRainbowLineColor0(mouseX, mouseY);
    let color = getRainbowLineColor1(lStruct, mouseX, mouseY);
    drawLine(lStruct, color, 8, x1, y1, x2, y2);
  }


  // DRAW LOOP
  const sleep = (ms) => {
		return new Promise(resolve => setTimeout(resolve, ms));
	}

	const draw = async() => {
		while(true)
		{
			await sleep(20);

      for (let i=0; i<numRows*numCols; i++) {
        // pointToCursor0(linesArr[i]);
        //pointToCursor1(linesArr[i]);
       // newPattern(linesArr[i]);
       circleLines(linesArr[i]);
      }
     /* console.log("in row 0,0: "+mouseInRow(linesArr[getIndex(0,0)]));
      console.log("in col 0,0: "+mouseInCol(linesArr[getIndex(0,0)]));
      console.log("in row 2,1: "+mouseInRow(linesArr[getIndex(2,1)]));
      console.log("in col 2,1: "+mouseInCol(linesArr[getIndex(2,1)]));*/

		}
	}

  setCanvasPositions();
  console.log(linesArr);
  draw();

</script>
